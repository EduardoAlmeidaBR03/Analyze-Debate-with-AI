<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Análise de Vídeos do YouTube</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        .hero-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 100px 0;
        }
        
        .card-custom {
            border: none;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }
        
        .card-custom:hover {
            transform: translateY(-5px);
        }
        
        .loading-spinner {
            display: none;
        }
        
        .result-section {
            display: none;
        }
        
        .analysis-card {
            background: #f8f9fa;
            border-left: 4px solid #007bff;
        }
        
        .transcript-card {
            background: #f1f3f4;
            border-left: 4px solid #28a745;
        }
        
        .video-info-card {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
        }
        
        .error-alert {
            display: none;
        }
        
        .word-cloud {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
        }
        
        .feature-icon {
            font-size: 3rem;
            color: #007bff;
            margin-bottom: 1rem;
        }
        
        .navbar-brand {
            font-weight: bold;
        }
        
        .btn-analyze {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            padding: 12px 30px;
            font-weight: bold;
        }
        
        .btn-analyze:hover {
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
            transform: translateY(-2px);
        }
        
        .progress-custom {
            height: 8px;
            border-radius: 4px;
        }
        
        .stats-card {
            text-align: center;
            padding: 20px;
        }
        
        .stats-number {
            font-size: 2rem;
            font-weight: bold;
            color: #007bff;
        }
        
        .footer {
            background-color: #343a40;
            color: white;
            padding: 40px 0;
            margin-top: 60px;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fab fa-youtube text-danger me-2"></i>
                Análise de Vídeos
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#home">Início</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#analyzer">Analisador</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#features">Recursos</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section id="home" class="hero-section text-center">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 mx-auto">
                    <h1 class="display-4 mb-4">
                        <i class="fab fa-youtube text-danger me-3"></i>
                        Análise Inteligente de Vídeos
                    </h1>
                    <p class="lead mb-4">
                        Transforme vídeos do YouTube em análises detalhadas usando IA. 
                        Obtenha transcrições, análises de conteúdo e insights valiosos.
                    </p>
                    <a href="#analyzer" class="btn btn-light btn-lg">
                        <i class="fas fa-play me-2"></i>
                        Começar Análise
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- Analyzer Section -->
    <section id="analyzer" class="py-5">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <div class="card card-custom">
                        <div class="card-header bg-primary text-white">
                            <h3 class="card-title mb-0">
                                <i class="fas fa-search me-2"></i>
                                Analisador de Vídeos do YouTube
                            </h3>
                        </div>
                        <div class="card-body p-4">
                            <form id="analyzeForm">
                                <div class="mb-4">
                                    <label for="youtubeUrl" class="form-label">
                                        <i class="fab fa-youtube text-danger me-2"></i>
                                        URL do Vídeo do YouTube
                                    </label>
                                    <input 
                                        type="url" 
                                        class="form-control form-control-lg" 
                                        id="youtubeUrl" 
                                        placeholder="https://www.youtube.com/watch?v=..." 
                                        required
                                    >
                                    <div class="form-text">
                                        Cole aqui a URL completa do vídeo do YouTube que deseja analisar
                                    </div>
                                </div>
                                
                                <div class="d-grid">
                                    <button type="submit" class="btn btn-analyze btn-lg">
                                        <i class="fas fa-magic me-2"></i>
                                        <span id="btnText">Analisar Vídeo</span>
                                    </button>
                                </div>
                            </form>

                            <!-- Loading Section -->
                            <div class="loading-spinner text-center py-4">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Carregando...</span>
                                </div>
                                <div class="mt-3">
                                    <h5>Processando vídeo...</h5>
                                    <p class="text-muted">Isso pode levar alguns segundos</p>
                                    <div class="progress progress-custom">
                                        <div class="progress-bar progress-bar-striped progress-bar-animated" 
                                             role="progressbar" style="width: 100%"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Error Alert -->
                            <div class="alert alert-danger error-alert" role="alert">
                                <i class="fas fa-exclamation-triangle me-2"></i>
                                <strong>Erro:</strong> <span id="errorMessage"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Results Section -->
    <section class="result-section py-5">
        <div class="container">
            <!-- Video Info -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card video-info-card">
                        <div class="card-body">
                            <h4 class="card-title">
                                <i class="fas fa-info-circle me-2"></i>
                                Informações do Vídeo
                            </h4>
                            <div class="row">
                                <div class="col-md-8">
                                    <h5 id="videoTitle" class="text-primary"></h5>
                                    <p class="mb-1"><strong>Canal:</strong> <span id="videoAuthor"></span></p>
                                    <p class="mb-1"><strong>Duração:</strong> <span id="videoDuration"></span></p>
                                    <p class="mb-0"><strong>Visualizações:</strong> <span id="videoViews"></span></p>
                                </div>
                                <div class="col-md-4">
                                    <div class="stats-card">
                                        <div class="stats-number" id="transcriptLength">0</div>
                                        <small class="text-muted">Caracteres na transcrição</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analysis Results -->
            <div class="row">
                <!-- Analysis -->
                <div class="col-lg-8 mb-4">
                    <div class="card analysis-card">
                        <div class="card-body">
                            <h4 class="card-title">
                                <i class="fas fa-brain me-2"></i>
                                Análise Inteligente
                            </h4>
                            <div id="analysisContent" class="mt-3"></div>
                        </div>
                    </div>
                </div>

                <!-- Transcript -->
                <div class="col-lg-4 mb-4">
                    <div class="card transcript-card">
                        <div class="card-body">
                            <h5 class="card-title">
                                <i class="fas fa-file-text me-2"></i>
                                Transcrição
                            </h5>
                            <div class="mb-3">
                                <small class="text-muted">
                                    Fonte: <span id="transcriptSource"></span>
                                </small>
                            </div>
                            <div id="transcriptContent" style="max-height: 400px; overflow-y: auto;" class="border p-3 rounded bg-white">
                            </div>
                            <button class="btn btn-outline-success btn-sm mt-2" onclick="downloadTranscript()">
                                <i class="fas fa-download me-1"></i>
                                Baixar Transcrição
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Word Cloud Section -->
            <div class="row">
                <!-- General Word Cloud -->
                <div class="col-12 mb-4">
                    <div class="card word-cloud">
                        <div class="card-body">
                            <h4 class="card-title">
                                <i class="fas fa-cloud me-2"></i>
                                Nuvem de Palavras Geral
                            </h4>
                            <div id="wordCloudContent" class="mt-3">
                                <p class="text-muted">A nuvem de palavras será exibida aqui após a análise.</p>
                            </div>
                            <div id="wordFrequencies" class="mt-4" style="display: none;">
                                <h5>Top 20 Palavras Mais Frequentes:</h5>
                                <div class="row" id="wordFrequencyList">
                                    <!-- Será preenchido via JavaScript -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Speaker Word Clouds -->
                <div class="col-lg-6 mb-4">
                    <div class="card" style="background: #ffebee; border-left: 4px solid #f44336;">
                        <div class="card-body">
                            <h4 class="card-title text-danger">
                                <i class="fas fa-user me-2"></i>
                                Nuvem de Palavras - Adriana
                            </h4>
                            <div id="adrianaWordCloudContent" class="mt-3">
                                <p class="text-muted">Nuvem de palavras das falas da Adriana será exibida aqui após a análise.</p>
                            </div>
                            <div id="adrianaWordFrequencies" class="mt-4" style="display: none;">
                                <h6>Top 10 Palavras da Adriana:</h6>
                                <div class="row" id="adrianaWordFrequencyList">
                                    <!-- Será preenchido via JavaScript -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-6 mb-4">
                    <div class="card" style="background: #e3f2fd; border-left: 4px solid #2196f3;">
                        <div class="card-body">
                            <h4 class="card-title text-primary">
                                <i class="fas fa-user me-2"></i>
                                Nuvem de Palavras - Lodovico
                            </h4>
                            <div id="lodovicoWordCloudContent" class="mt-3">
                                <p class="text-muted">Nuvem de palavras das falas do Lodovico será exibida aqui após a análise.</p>
                            </div>
                            <div id="lodovicoWordFrequencies" class="mt-4" style="display: none;">
                                <h6>Top 10 Palavras do Lodovico:</h6>
                                <div class="row" id="lodovicoWordFrequencyList">
                                    <!-- Será preenchido via JavaScript -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Actions -->
            <div class="row mt-4">
                <div class="col-12 text-center">
                    <button class="btn btn-primary me-2" onclick="downloadAnalysis()">
                        <i class="fas fa-download me-1"></i>
                        Baixar Análise Completa
                    </button>
                    <button class="btn btn-success me-2" onclick="downloadWordCloud()">
                        <i class="fas fa-cloud-download-alt me-1"></i>
                        Baixar Nuvem Geral
                    </button>
                    <button class="btn btn-danger me-2" onclick="downloadSpeakerWordCloud('adriana')">
                        <i class="fas fa-download me-1"></i>
                        Baixar Nuvem - Adriana
                    </button>
                    <button class="btn btn-info me-2" onclick="downloadSpeakerWordCloud('lodovico')">
                        <i class="fas fa-download me-1"></i>
                        Baixar Nuvem - Lodovico
                    </button>
                    <button class="btn btn-secondary" onclick="resetForm()">
                        <i class="fas fa-redo me-1"></i>
                        Nova Análise
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Features Section -->
    <section id="features" class="py-5 bg-light">
        <div class="container">
            <div class="row text-center mb-5">
                <div class="col-12">
                    <h2 class="display-5 mb-4">Recursos Avançados</h2>
                    <p class="lead text-muted">Descubra tudo o que nossa plataforma pode fazer por você</p>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-4 mb-4">
                    <div class="card card-custom h-100 text-center">
                        <div class="card-body">
                            <i class="fas fa-language feature-icon"></i>
                            <h4>Transcrição em Português</h4>
                            <p class="text-muted">
                                Extraímos automaticamente legendas e transcrições em português dos vídeos do YouTube.
                            </p>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 mb-4">
                    <div class="card card-custom h-100 text-center">
                        <div class="card-body">
                            <i class="fas fa-robot feature-icon"></i>
                            <h4>IA Gemini</h4>
                            <p class="text-muted">
                                Utilizamos a inteligência artificial do Google Gemini para análises profundas e precisas.
                            </p>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 mb-4">
                    <div class="card card-custom h-100 text-center">
                        <div class="card-body">
                            <i class="fas fa-chart-bar feature-icon"></i>
                            <h4>Análise de Debates</h4>
                            <p class="text-muted">
                                Análise especializada para debates, identificando pontos positivos de cada participante.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-lg-6">
                    <h5>Análise de Vídeos do YouTube</h5>
                    <p class="text-muted">
                        Transforme conteúdo em insights valiosos usando inteligência artificial.
                    </p>
                </div>
                <div class="col-lg-6 text-lg-end">
                    <p class="text-muted mb-0">
                        Desenvolvido com <i class="fas fa-heart text-danger"></i> usando Flask e Bootstrap
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // API Configuration
        const API_BASE_URL = 'http://localhost:5000';
        let currentAnalysisData = null;

        // Form submission
        document.getElementById('analyzeForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const youtubeUrl = document.getElementById('youtubeUrl').value;
            
            if (!youtubeUrl) {
                showError('Por favor, insira uma URL válida do YouTube.');
                return;
            }

            // Show loading
            showLoading();
            hideError();
            hideResults();

            try {
                const response = await fetch(`${API_BASE_URL}/analyze-youtube`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        youtube_url: youtubeUrl
                    })
                });

                const data = await response.json();

                if (response.ok && data.status === 'success') {
                    currentAnalysisData = data;
                    displayResults(data);
                    showResults();
                } else {
                    showError(data.error || 'Erro ao processar o vídeo.');
                }
            } catch (error) {
                console.error('Error:', error);
                showError('Erro de conexão. Verifique se a API está rodando.');
            } finally {
                hideLoading();
            }
        });

        function showLoading() {
            document.querySelector('.loading-spinner').style.display = 'block';
            document.getElementById('btnText').textContent = 'Processando...';
            document.querySelector('button[type="submit"]').disabled = true;
        }

        function hideLoading() {
            document.querySelector('.loading-spinner').style.display = 'none';
            document.getElementById('btnText').textContent = 'Analisar Vídeo';
            document.querySelector('button[type="submit"]').disabled = false;
        }

        function showError(message) {
            document.getElementById('errorMessage').textContent = message;
            document.querySelector('.error-alert').style.display = 'block';
        }

        function hideError() {
            document.querySelector('.error-alert').style.display = 'none';
        }

        function showResults() {
            document.querySelector('.result-section').style.display = 'block';
            // Scroll to results
            document.querySelector('.result-section').scrollIntoView({ 
                behavior: 'smooth' 
            });
        }

        function hideResults() {
            document.querySelector('.result-section').style.display = 'none';
        }

        function displayResults(data) {
            console.log('Dados recebidos:', data); // Debug log
            
            // Video Info com tratamento melhorado
            if (data.video_info) {
                console.log('Video info:', data.video_info); // Debug log
                
                const title = data.video_info.title || 'Título não disponível';
                const author = data.video_info.author || 'Canal não disponível';
                const duration = data.video_info.length ? formatDuration(data.video_info.length) : 'Duração não disponível';
                const views = data.video_info.views ? formatNumber(data.video_info.views) : 'Visualizações não disponíveis';
                
                // Limpar caracteres de escape do JSON se houver
                document.getElementById('videoTitle').textContent = title.replace(/\\"/g, '"').replace(/\\\\/g, '\\');
                document.getElementById('videoAuthor').textContent = author.replace(/\\"/g, '"').replace(/\\\\/g, '\\');
                document.getElementById('videoDuration').textContent = duration;
                document.getElementById('videoViews').textContent = views;
            } else {
                console.log('Video info não disponível');
                document.getElementById('videoTitle').textContent = 'Informações do vídeo não disponíveis';
                document.getElementById('videoAuthor').textContent = 'Canal não identificado';
                document.getElementById('videoDuration').textContent = 'Duração não disponível';
                document.getElementById('videoViews').textContent = 'Visualizações não disponíveis';
            }

            // Transcript info
            document.getElementById('transcriptLength').textContent = formatNumber(data.transcript_length || 0);
            document.getElementById('transcriptSource').textContent = getSourceLabel(data.transcript_source);

            // Analysis
            document.getElementById('analysisContent').innerHTML = formatAnalysis(data.analysis);

            // Transcript (if available)
            if (data.transcript) {
                document.getElementById('transcriptContent').innerHTML = `<pre style="white-space: pre-wrap; font-family: inherit;">${data.transcript}</pre>`;
            } else {
                document.getElementById('transcriptContent').innerHTML = '<p class="text-muted">Transcrição não disponível</p>';
            }

            // Word cloud (if available)
            displayWordCloud(data.wordcloud, data.word_frequencies);
            
            // Speaker word clouds (if available)
            displaySpeakerWordClouds(data.speaker_wordclouds);
        }

        function formatDuration(seconds) {
            if (!seconds || seconds === 0) return 'Duração não disponível';
            
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            
            if (hours > 0) {
                return `${hours}h ${minutes}m ${secs}s`;
            }
            return `${minutes}m ${secs}s`;
        }

        function formatNumber(num) {
            if (!num || num === 0) return '0';
            return new Intl.NumberFormat('pt-BR').format(num);
        }

        function getSourceLabel(source) {
            const labels = {
                'youtube_transcript_api': 'YouTube Transcript API',
                'youtube_description': 'Descrição do YouTube',
                'kome.ai': 'Kome.ai'
            };
            return labels[source] || source;
        }

        function formatAnalysis(analysis) {
            if (!analysis) return '<p class="text-muted">Análise não disponível.</p>';
            
            // Convert line breaks to HTML
            return analysis.replace(/\n/g, '<br>').replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
        }

        function displayWordCloud(wordcloudImg, wordFrequencies) {
            const wordCloudSection = document.getElementById('wordCloudContent');
            const wordFrequenciesSection = document.getElementById('wordFrequencies');
            const wordFrequencyList = document.getElementById('wordFrequencyList');
            
            if (wordcloudImg) {
                // Exibir a imagem da nuvem de palavras
                wordCloudSection.innerHTML = `
                    <div class="text-center">
                        <img src="data:image/png;base64,${wordcloudImg}" 
                             class="img-fluid rounded shadow" 
                             alt="Nuvem de Palavras" 
                             style="max-width: 100%; height: auto;">
                    </div>
                `;
                
                // Exibir a lista de frequências se disponível
                if (wordFrequencies && wordFrequencies.length > 0) {
                    wordFrequenciesSection.style.display = 'block';
                    
                    let frequencyHTML = '';
                    // Mostrar apenas as primeiras 20 palavras
                    const topWords = wordFrequencies.slice(0, 20);
                    
                    topWords.forEach((item, index) => {
                        const [word, count] = item;
                        const badgeColor = index < 5 ? 'bg-danger' : 
                                         index < 10 ? 'bg-warning' : 
                                         index < 15 ? 'bg-info' : 'bg-secondary';
                        
                        frequencyHTML += `
                            <div class="col-md-3 col-sm-4 col-6 mb-2">
                                <div class="d-flex align-items-center">
                                    <span class="badge ${badgeColor} me-2">${count}</span>
                                    <span class="small">${word}</span>
                                </div>
                            </div>
                        `;
                    });
                    
                    wordFrequencyList.innerHTML = frequencyHTML;
                } else {
                    wordFrequenciesSection.style.display = 'none';
                }
            } else {
                // Fallback para análise textual (método antigo)
                wordCloudSection.innerHTML = '<p class="text-muted">Nuvem de palavras não disponível. Verifique se as dependências estão instaladas.</p>';
                wordFrequenciesSection.style.display = 'none';
            }
        }

        function displaySpeakerWordClouds(speakerWordclouds) {
            if (!speakerWordclouds) {
                console.log('Nenhuma nuvem de palavras de participantes disponível');
                return;
            }
            
            // Display Adriana's word cloud
            if (speakerWordclouds.adriana) {
                const adrianaContent = document.getElementById('adrianaWordCloudContent');
                const adrianaFrequencies = document.getElementById('adrianaWordFrequencies');
                const adrianaFrequencyList = document.getElementById('adrianaWordFrequencyList');
                
                adrianaContent.innerHTML = `
                    <div class="text-center">
                        <img src="data:image/png;base64,${speakerWordclouds.adriana.image}" 
                             class="img-fluid rounded shadow" 
                             alt="Nuvem de Palavras - Adriana" 
                             style="max-width: 100%; height: auto;">
                        <p class="small text-muted mt-2">
                            ${speakerWordclouds.adriana.text_length} caracteres analisados
                        </p>
                    </div>
                `;
                
                if (speakerWordclouds.adriana.word_frequencies && speakerWordclouds.adriana.word_frequencies.length > 0) {
                    adrianaFrequencies.style.display = 'block';
                    
                    let frequencyHTML = '';
                    const topWords = speakerWordclouds.adriana.word_frequencies.slice(0, 10);
                    
                    topWords.forEach((item, index) => {
                        const [word, count] = item;
                        const badgeColor = index < 3 ? 'bg-danger' : 
                                         index < 6 ? 'bg-warning text-dark' : 'bg-secondary';
                        
                        frequencyHTML += `
                            <div class="col-md-6 col-12 mb-2">
                                <div class="d-flex align-items-center">
                                    <span class="badge ${badgeColor} me-2">${count}</span>
                                    <span class="small">${word}</span>
                                </div>
                            </div>
                        `;
                    });
                    
                    adrianaFrequencyList.innerHTML = frequencyHTML;
                }
            } else {
                document.getElementById('adrianaWordCloudContent').innerHTML = 
                    '<p class="text-muted">Não foram encontradas falas específicas da Adriana na transcrição.</p>';
            }
            
            // Display Lodovico's word cloud
            if (speakerWordclouds.lodovico) {
                const lodovicoContent = document.getElementById('lodovicoWordCloudContent');
                const lodovicoFrequencies = document.getElementById('lodovicoWordFrequencies');
                const lodovicoFrequencyList = document.getElementById('lodovicoWordFrequencyList');
                
                lodovicoContent.innerHTML = `
                    <div class="text-center">
                        <img src="data:image/png;base64,${speakerWordclouds.lodovico.image}" 
                             class="img-fluid rounded shadow" 
                             alt="Nuvem de Palavras - Lodovico" 
                             style="max-width: 100%; height: auto;">
                        <p class="small text-muted mt-2">
                            ${speakerWordclouds.lodovico.text_length} caracteres analisados
                        </p>
                    </div>
                `;
                
                if (speakerWordclouds.lodovico.word_frequencies && speakerWordclouds.lodovico.word_frequencies.length > 0) {
                    lodovicoFrequencies.style.display = 'block';
                    
                    let frequencyHTML = '';
                    const topWords = speakerWordclouds.lodovico.word_frequencies.slice(0, 10);
                    
                    topWords.forEach((item, index) => {
                        const [word, count] = item;
                        const badgeColor = index < 3 ? 'bg-primary' : 
                                         index < 6 ? 'bg-info text-dark' : 'bg-secondary';
                        
                        frequencyHTML += `
                            <div class="col-md-6 col-12 mb-2">
                                <div class="d-flex align-items-center">
                                    <span class="badge ${badgeColor} me-2">${count}</span>
                                    <span class="small">${word}</span>
                                </div>
                            </div>
                        `;
                    });
                    
                    lodovicoFrequencyList.innerHTML = frequencyHTML;
                }
            } else {
                document.getElementById('lodovicoWordCloudContent').innerHTML = 
                    '<p class="text-muted">Não foram encontradas falas específicas do Lodovico na transcrição.</p>';
            }
        }

        function downloadTranscript() {
            if (!currentAnalysisData) {
                alert('Nenhuma análise disponível para download.');
                return;
            }
            
            const transcript = currentAnalysisData.transcript;
            if (!transcript || transcript === 'Transcrição não disponível') {
                alert('Transcrição não está disponível para este vídeo.');
                return;
            }
            
            const videoTitle = currentAnalysisData.video_info?.title || 'video';
            const cleanTitle = videoTitle.replace(/[^a-zA-Z0-9\s]/g, '').replace(/\s+/g, '_');
            
            downloadFile(`transcricao_${cleanTitle}.txt`, transcript);
        }

        function downloadAnalysis() {
            if (!currentAnalysisData) {
                alert('Nenhuma análise disponível para download.');
                return;
            }
            
            const analysis = currentAnalysisData.analysis;
            if (!analysis || analysis === 'Análise não disponível') {
                alert('Análise não está disponível.');
                return;
            }
            
            const videoTitle = currentAnalysisData.video_info?.title || 'video';
            const cleanTitle = videoTitle.replace(/[^a-zA-Z0-9\s]/g, '').replace(/\s+/g, '_');
            
            downloadFile(`analise_${cleanTitle}.txt`, analysis);
        }

        function downloadFile(filename, content) {
            const element = document.createElement('a');
            element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(content));
            element.setAttribute('download', filename);
            element.style.display = 'none';
            document.body.appendChild(element);
            element.click();
            document.body.removeChild(element);
        }

        function downloadWordCloud() {
            if (!currentAnalysisData) {
                alert('Nenhuma análise disponível para download.');
                return;
            }
            
            const wordcloudImg = currentAnalysisData.wordcloud;
            if (!wordcloudImg) {
                alert('Nuvem de palavras não está disponível.');
                return;
            }
            
            const videoTitle = currentAnalysisData.video_info?.title || 'video';
            const cleanTitle = videoTitle.replace(/[^a-zA-Z0-9\s]/g, '').replace(/\s+/g, '_');
            
            // Converter base64 para blob
            const byteCharacters = atob(wordcloudImg);
            const byteNumbers = new Array(byteCharacters.length);
            for (let i = 0; i < byteCharacters.length; i++) {
                byteNumbers[i] = byteCharacters.charCodeAt(i);
            }
            const byteArray = new Uint8Array(byteNumbers);
            const blob = new Blob([byteArray], {type: 'image/png'});
            
            // Criar link de download
            const element = document.createElement('a');
            element.setAttribute('href', URL.createObjectURL(blob));
            element.setAttribute('download', `nuvem_palavras_geral_${cleanTitle}.png`);
            element.style.display = 'none';
            document.body.appendChild(element);
            element.click();
            document.body.removeChild(element);
            
            // Liberar o URL
            URL.revokeObjectURL(element.href);
        }

        function downloadSpeakerWordCloud(speaker) {
            if (!currentAnalysisData) {
                alert('Nenhuma análise disponível para download.');
                return;
            }
            
            const speakerWordclouds = currentAnalysisData.speaker_wordclouds;
            if (!speakerWordclouds || !speakerWordclouds[speaker]) {
                alert(`Nuvem de palavras do ${speaker === 'adriana' ? 'Adriana' : 'Lodovico'} não está disponível.`);
                return;
            }
            
            const wordcloudImg = speakerWordclouds[speaker].image;
            if (!wordcloudImg) {
                alert(`Imagem da nuvem de palavras do ${speaker === 'adriana' ? 'Adriana' : 'Lodovico'} não está disponível.`);
                return;
            }
            
            const videoTitle = currentAnalysisData.video_info?.title || 'video';
            const cleanTitle = videoTitle.replace(/[^a-zA-Z0-9\s]/g, '').replace(/\s+/g, '_');
            const speakerName = speaker === 'adriana' ? 'Adriana' : 'Lodovico';
            
            // Converter base64 para blob
            const byteCharacters = atob(wordcloudImg);
            const byteNumbers = new Array(byteCharacters.length);
            for (let i = 0; i < byteCharacters.length; i++) {
                byteNumbers[i] = byteCharacters.charCodeAt(i);
            }
            const byteArray = new Uint8Array(byteNumbers);
            const blob = new Blob([byteArray], {type: 'image/png'});
            
            // Criar link de download
            const element = document.createElement('a');
            element.setAttribute('href', URL.createObjectURL(blob));
            element.setAttribute('download', `nuvem_palavras_${speakerName}_${cleanTitle}.png`);
            element.style.display = 'none';
            document.body.appendChild(element);
            element.click();
            document.body.removeChild(element);
            
            // Liberar o URL
            URL.revokeObjectURL(element.href);
        }

        function resetForm() {
            document.getElementById('analyzeForm').reset();
            hideResults();
            hideError();
            currentAnalysisData = null;
        }

        // Smooth scrolling for navigation links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });
    </script>
</body>
</html>